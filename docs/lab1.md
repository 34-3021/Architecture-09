# Lab 1

佟铭洋  
23300240009

## 思路与过程

实际上一开始，不应该直接从代码或者说各个部分的实现入手，而是应该先解决如何分块，每个部分有什么数据要传递，如何传递的问题。

沿用传统路径，我们仍然将流水线的 5 个部分划分为 Fetch, Decode, Execute, Memory, Writeback。

由于本次暂不涉及到数据的读写内存，因此暂时不需要处理 Memory 的部分。由于此次也无任何跳转指令，实际上 PC 就是 +4。

我们约定每个部分应当以上升沿为信号，将当前部分的处理结果传递给下一部分。也就是说，每个部分的开头都应当有一个寄存器用来存储当前时钟周期内用于本部分计算的内容。

接下来，描述每个部分应该干什么：

### Fetch

**组合逻辑**

- 其应当维护一个 PC（64位）。

- 接受一个输入（64位），用于完全更改这个 PC。接受一个输入（1位），用来对这个更改进行使能。（本 Lab 暂时不考虑这个东西）

- 可以访问内存，读取内容为当前 PC 指定内存为起点的连续 4 字节内容（32位）。

**拟传递给下一级的信号**

- 自增 4 后的 PC（64位）。

- 内存中当前 PC 指定内存为起点的连续 4 字节内容（32位）。

**当时钟上升**

将拟传递给下一级的信号发送。（IF/ID触发器）

PC 为 自增 4 后的 PC 或更改为输入的信号，取决于使能。

### Decode

**组合逻辑**

通过指令，计算出：

- 当前所需要读取的寄存器ID（5位*2）

- 立即数（且符号扩展后，64位）

- ALU B 输入的信号来源

- ALU 的工作模式（运算类型）

- 是否有写回

- 写回寄存器的 ID

- 是否跳转

通过访问寄存器，得到：

- 当前读取的寄存器值（64位*2）

**拟传递给下一级的信号**

- 自增 4 后的 PC（64位）。

- 读取的两个寄存器值（64位*2）。

- 立即数（且符号扩展后，64位）

- ALU B 输入的信号来源

- ALU 的工作模式（运算类型）

- 是否有写回

- 写回寄存器的 ID

**当时钟上升**

将拟传递给下一级的信号发送。（ID/EX触发器）

**当时钟下降**

ALU 计算。

### Execute

**组合逻辑**

通过：

- 读取的两个寄存器值（64位*2）。

- 立即数（且符号扩展后，64位）

- ALU B 输入的信号来源

- ALU 的工作模式（运算类型）

计算出 ALU 结果

**拟传递给下一级的信号**

- RD2

- ALU 输出

- 是否有写回

- 写回寄存器的 ID


### Memory

略。

### Writeback

**组合逻辑**

通过：

- 是否有写回

- 写回寄存器的 ID

- ALU 输出

判断是否需要写回和写回的值

**当时钟下降（注意是下降）**

> 为什么是下降？确保数据稳定。

对寄存器进行写回。